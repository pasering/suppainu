<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>乱数コロシアム</title>
<style>
body { font-family: Arial, sans-serif; background-color: #f0f0f0; color: #333; margin: 20px; }
h1 { text-align: center; color: #AA3513; font-size: 2em; }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background-color: #4CAF50; color: white; }
button { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; cursor: pointer; margin-bottom: 5px; }
button:hover { background-color: #45a049; }
#battleLog { margin-top: 20px; border: 1px solid #ddd; padding: 10px; background-color: #fff; font-size: 0.9em; }
.player-log { color: blue; }
.opponent-log { color: red; padding-left: 1em; }
.result-log { font-size: 1.5em; font-weight: bold; }
#highScore { font-size: 2.25em; font-weight: bold; color: #4CAF50; }
#mockBattleButton { font-size: 2em; }
.special-button { background-color: #FF5722; }
.special-button:hover { background-color: #E64A19; }
.uniform-button { height: 40px; }
.large-text { font-size: 2em; }
#playerName { font-size: 1.5em; }
.slime-button { background-color: #0091E0; }
.gorilla-button { background-color: #32CD32; }
.dragon-button { background-color: #FF4500; }
td.current-value { background-color: #f9f9f9; }
td.enhancement { background-color: #e0f7fa; }
td.success-rate { background-color: #fff3e0; }
.tooltip { position: relative; display: inline-block; }
.tooltip .tooltiptext { visibility: hidden; width: 120px; background-color: #555; color: #fff; text-align: center; border-radius: 6px; padding: 5px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; }
.tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
#itemContainer { display: flex; flex-direction: column; align-items: flex-start; }
#itemList { border: 1px solid #ddd; padding: 10px; background-color: #fff; display: flex; flex-direction: row; flex-wrap: wrap; }
.item { margin-right: 10px; }
#itemGachaButton { background-color: red; font-size: 1.5em; }
</style>
</head>
<body>
<h1>乱数コロシアム</h1><h3>  ver0.11</h3>

<p>ハイスコア: <span id="highScore">0</span></p>
<button class="uniform-button" onclick="levelUp()">レベルアップ</button>
<button class="uniform-button" onclick="levelUpMultiple(10)">10LVUP</button>
<button class="uniform-button" onclick="levelUpMax()">LVMAX</button>
<button class="uniform-button" onclick="resetGame()">LVリセット</button>　
<button class="uniform-button" onclick="resetHighScore()">ハイスコアリセット</button>

<p>現在のレベル: <span id="currentLevel">1</span>　　残りステータスポイント: <span id="remainingPoints">50</span></p>

<table>
<thead>
<tr><th>パラメーター</th><th>攻撃力</th><th>防御力</th><th>体力</th><th>素早さ</th><th>賢さ</th><th>運の良さ</th></tr>
</thead>
<tbody>
<tr class="current-value"><td>現在の値</td><td id="攻撃力" class="large-text"></td><td id="防御力" class="large-text"></td><td id="体力" class="large-text"></td><td id="素早さ" class="large-text"></td><td id="賢さ" class="large-text"></td><td id="運の良さ" class="large-text"></td></tr>
<tr class="enhancement"><td>強化</td>
<td><button onclick="increaseParameter(0)">UP</button><span style="display:inline-block; width: 2.5px;"></span><button onclick="increaseParameterMultiple(0, 10)">×10回</button></td>
<td><button onclick="increaseParameter(1)">UP</button><span style="display:inline-block; width: 2.5px;"></span><button onclick="increaseParameterMultiple(1, 10)">×10回</button></td>
<td><button onclick="increaseParameter(2)">UP</button><span style="display:inline-block; width: 2.5px;"></span><button onclick="increaseParameterMultiple(2, 10)">×10回</button></td>
<td><button onclick="increaseParameter(3)">UP</button><span style="display:inline-block; width: 2.5px;"></span><button onclick="increaseParameterMultiple(3, 10)">×10回</button></td>
<td><button onclick="increaseParameter(4)">UP</button><span style="display:inline-block; width: 2.5px;"></span><button onclick="increaseParameterMultiple(4, 10)">×10回</button></td>
<td><button onclick="increaseParameter(5)">UP</button><span style="display:inline-block; width: 2.5px;"></span><button onclick="increaseParameterMultiple(5, 10)">×10回</button></td>
</tr>
<tr class="success-rate"><td>成功率</td><td id="攻撃力成功率"></td><td id="防御力成功率"></td><td id="体力成功率"></td><td id="素早さ成功率"></td><td id="賢さ成功率"></td><td id="運の良さ成功率"></td></tr>
</tbody>
</table>
<table style="width: 100%;">
<tr>
<td style="width: 25%;"><button id="itemGachaButton" class="uniform-button" onclick="itemGacha()">アイテムガチャ</button></td>
<td style="width: 25%;" id="item1">アイテムなし</td>
<td style="width: 25%;" id="item2">アイテムなし</td>
<td style="width: 25%;" id="item3">アイテムなし</td>
</tr>
</table>
<p>アイテムガチャ、1回２０ポイント！ 何度でも引き直しＯＫ！</p>
<hr>
<div>
<input type="text" id="playerName" placeholder="プレイヤー名を入力">
<hr>

<div class="tooltip"><button id="mockBattleButton" class="special-button slime-button" onclick="startMockBattle('スライム')">スライムと戦う</button>
<span class="tooltiptext" id="slimeStats"></span></div>
<div class="tooltip"><button id="mockBattleButton" class="special-button gorilla-button" onclick="startMockBattle('ゴリラ')">ゴリラと戦う</button>
<span class="tooltiptext" id="gorillaStats"></span></div>
<div class="tooltip"><button id="mockBattleButton" class="special-button dragon-button" onclick="startMockBattle('ドラゴン')">ドラゴンと戦う</button>
<span class="tooltiptext" id="dragonStats"></span></div>
</div>

<div>
<button class="uniform-button" onclick="getCurrentStatus()">現在のステータスを取得</button>
<p id="currentStatus"></p>
<textarea rows="1.5" cols="105" id="opponentStatus" placeholder="他プレイヤーのステータスをここにコピー"></textarea>
<BR>
<button class="uniform-button" onclick="startPlayerBattle()">このプレイヤーと対戦</button>
</div>


<div id="battleLog" style="display:none;"></div>
<script>
const initialPoints = 50;
let remainingPoints = initialPoints, currentLevel = 1, highScore = 0;
const parameters = [{ name: '攻撃力', value: 1, failCount: 0 }, { name: '防御力', value: 1, failCount: 0 }, { name: '体力', value: 1, failCount: 0 }, { name: '素早さ', value: 1, failCount: 0 }, { name: '賢さ', value: 1, failCount: 0 }, { name: '運の良さ', value: 1, failCount: 0 }];
const items = [
{ name: '包丁', effect: { '攻撃力': 5 } },
{ name: '鋼の剣', effect: { '攻撃力': 10 } },
{ name: '伝説の剣', effect: { '攻撃力': 15 } },
{ name: '革ジャン', effect: { '防御力': 5 } },
{ name: '防弾チョッキ', effect: { '防御力': 10 } },
{ name: 'ダイヤの鎧', effect: { '防御力': 15 } },
{ name: 'スニーカー', effect: { '素早さ': 5 } },
{ name: '俊足', effect: { '素早さ': 10 } },
{ name: 'ジェットシューズ', effect: { '素早さ': 15 } },
{ name: 'サーカスの服', effect: { '攻撃回避率': 10 } },
{ name: 'ポーション', effect: { '体力': 10 } },
{ name: 'ハイポーション', effect: { '体力': 20 } },
{ name: '四葉のクローバー', effect: { '運の良さ': 10 } },
{ name: '招き猫', effect: { '運の良さ': 15 } },
{ name: 'ただのゴミ', effect: { '効果なし': 0 } }
];

let acquiredItems = [];

function calculateSuccessRate(value, failCount) {
let baseRate = Math.max(1, 100 - value);
for (let i = 0; i < failCount; i++) baseRate += baseRate * 0.3;
return Math.min(baseRate, 90);
}

function updateDisplay() {
parameters.forEach(param => {
const successRate = calculateSuccessRate(param.value, param.failCount);
document.getElementById(param.name).innerText = param.value;
document.getElementById(param.name + '成功率').innerText = successRate.toFixed(2) + '%';
});
document.getElementById('remainingPoints').innerText = remainingPoints;
document.getElementById('currentLevel').innerText = currentLevel;
document.getElementById('highScore').innerText = highScore;
document.getElementById('item1').innerHTML = acquiredItems[0] ? `<div class="tooltip item">${acquiredItems[0].name}<span class="tooltiptext">${Object.entries(acquiredItems[0].effect).map(([key, value]) => `${key}: ${value}`).join('<br>')}</span></div>` : 'アイテムなし';
document.getElementById('item2').innerHTML = acquiredItems[1] ? `<div class="tooltip item">${acquiredItems[1].name}<span class="tooltiptext">${Object.entries(acquiredItems[1].effect).map(([key, value]) => `${key}: ${value}`).join('<br>')}</span></div>` : 'アイテムなし';
document.getElementById('item3').innerHTML = acquiredItems[2] ? `<div class="tooltip item">${acquiredItems[2].name}<span class="tooltiptext">${Object.entries(acquiredItems[2].effect).map(([key, value]) => `${key}: ${value}`).join('<br>')}</span></div>` : 'アイテムなし';
}

function increaseParameter(index) {
if (remainingPoints > 0) {
const param = parameters[index];
const successRate = calculateSuccessRate(param.value, param.failCount);
if (Math.random() * 100 < successRate) {
param.value += 1;
param.failCount = 0;
} else {
param.failCount += 1;
}
remainingPoints -= 1;
updateDisplay();
}
}

function increaseParameterMultiple(index, times) {
for (let i = 0; i < times; i++) {
if (remainingPoints > 0) increaseParameter(index);
else break;
}
}

function levelUp() {
if (currentLevel < 50) {
remainingPoints += 10;
currentLevel += 1;
updateDisplay();
} else alert("最大レベルに達しました！");
}

function levelUpMultiple(times) {
for (let i = 0; i < times; i++) {
if (currentLevel < 50) levelUp();
else break;
}
}

function levelUpMax() {
while (currentLevel < 50) levelUp();
}

function resetGame() {
remainingPoints = initialPoints;
currentLevel = 1;
parameters.forEach(param => { param.value = 1; param.failCount = 0; });
acquiredItems = [];
updateDisplay();
}

function resetHighScore() {
highScore = 0;
document.getElementById('highScore').innerText = highScore;
}

function itemGacha() {
if (remainingPoints < 20) {
alert("ステータスポイントが足りません！");
return;
}
remainingPoints -= 20;
const selectedItems = [];
while (selectedItems.length < 3) {
const item = items[Math.floor(Math.random() * items.length)];
if (!selectedItems.includes(item)) selectedItems.push(item);
}
acquiredItems = selectedItems;
updateDisplay();
}

function calculateDodgeRate(player) {
let dodgeRate = player.素早さ * 0.2 + player.運の良さ * 0.1;
acquiredItems.forEach(item => {
if (item.effect['攻撃回避率']) {
dodgeRate += item.effect['攻撃回避率'];
}
});
return dodgeRate;
}

function startMockBattle(opponentType) {
const battleLog = document.getElementById('battleLog');
battleLog.style.display = 'block';
battleLog.innerHTML = '';
const opponent = {
'スライム': { 攻撃力: 30, 防御力: 30, 体力: 40, 素早さ: 30, 賢さ: 20, 運の良さ: 40 },
'ゴリラ': { 攻撃力: 65, 防御力: 50, 体力: 60, 素早さ: 40, 賢さ: 40, 運の良さ: 20 },
'ドラゴン': { 攻撃力: 70, 防御力: 70, 体力: 70, 素早さ: 65, 賢さ: 70, 運の良さ: 40 }
}[opponentType];
const player = {};
const intelligenceBonus = Math.floor(parameters.find(param => param.name === '賢さ').value * 0.25);
const opponentIntelligenceBonus = Math.floor(opponent.賢さ * 0.25);
parameters.forEach(param => {
player[param.name] = param.value + (param.name !== '賢さ' ? intelligenceBonus : 0);
opponent[param.name] += (param.name !== '賢さ' ? opponentIntelligenceBonus : 0);
});
player.体力 = player.体力 || 1; // Ensure player has some health

// Apply item effects
acquiredItems.forEach(item => {
Object.entries(item.effect).forEach(([key, value]) => {
player[key] += value;
});
});

let totalDamage = 0, criticalHits = 0, consecutiveAttacks = 0;

function logBattle(message, className) {
battleLog.innerHTML += `<p class="${className}">${message}</p>`;
}

function calculateDamage(attacker, defender) {
let damage = Math.ceil((attacker.攻撃力 - ( defender.防御力 - 10 )) * 0.1);
damage = Math.max(damage, 1); // Ensure damage is at least 1
if (Math.random() * 100 < attacker.運の良さ / 2) {
damage += Math.ceil(1.2 * damage * (attacker.運の良さ / 100));
logBattle(`クリティカルヒット！ダメージが増加しました。`, attacker === player ? 'player-log' : 'opponent-log');
if (attacker === player) criticalHits++;
}
return damage;
}

function battleTurn(attacker, defender, attackerName, defenderName, className) {
const dodgeRate = calculateDodgeRate(defender);
if (Math.random() * 100 < dodgeRate) {
logBattle(`${attackerName}の攻撃は避けられた！`, className);
return false;
}
let damage = calculateDamage(attacker, defender);
defender.体力 -= damage;
logBattle(`${attackerName}の攻撃！${defenderName}に${damage}のダメージ。残り体力: ${defender.体力}`, className);
if (attacker === player) totalDamage += damage;
if (defender.体力 <= 0) {
logBattle(`${defenderName}は倒れた！`, className);
return true;
}
return false;
}

function battle() {
let playerTurn = player.素早さ >= opponent.素早さ;
let victoryPoints = 0;
while (player.体力 > 0 && opponent.体力 > 0) {
if (playerTurn) {
if (battleTurn(player, opponent, document.getElementById('playerName').value || 'プレイヤー', opponentType, 'player-log')) {
logBattle('プレイヤーの勝利！', 'result-log');
if (opponentType === 'スライム') {
victoryPoints = 200;
} else if (opponentType === 'ゴリラ') {
victoryPoints = 200;
} else if (opponentType === 'ドラゴン') {
victoryPoints = 200;
}
break;
}
if (Math.random() * 100 < (player.素早さ - opponent.素早さ)) {
logBattle('プレイヤーの連続攻撃！', 'player-log');
consecutiveAttacks++;
continue;
}
} else {
if (battleTurn(opponent, player, opponentType, document.getElementById('playerName').value || 'プレイヤー', 'opponent-log')) {
logBattle('相手の勝利...', 'result-log');
break;
}
if (Math.random() * 100 < (opponent.素早さ - player.素早さ)) {
logBattle('相手の連続攻撃！', 'opponent-log');
continue;
}
}
playerTurn = !playerTurn;
}
const scoreMultiplier = opponentType === 'スライム' ? 0.4 : opponentType === 'ゴリラ' ? 0.7 : 1;
const score = Math.floor((totalDamage + (player.攻撃力 * 1.5) + (player.防御力) + (player.体力 * 4) + (criticalHits * 4) + (consecutiveAttacks * 3) + victoryPoints) * (62 - currentLevel) * scoreMultiplier);
logBattle(`スコア: ${score}`, 'result-log');
if (score > highScore) {
highScore = score;
logBattle(`新しいハイスコア: ${highScore}`, 'result-log');
}
document.getElementById('highScore').innerText = highScore;
}

battle();
}

function showStats(opponentType) {
const opponent = {
'スライム': { 攻撃力: 30, 防御力: 30, 体力: 40, 素早さ: 30, 賢さ: 20, 運の良さ: 40 },
'ゴリラ': { 攻撃力: 65, 防御力: 50, 体力: 60, 素早さ: 40, 賢さ: 40, 運の良さ: 20 },
'ドラゴン': { 攻撃力: 70, 防御力: 70, 体力: 70, 素早さ: 65, 賢さ: 70, 運の良さ: 40 }
}[opponentType];
return `攻撃力: ${opponent.攻撃力}<br>防御力: ${opponent.防御力}<br>体力: ${opponent.体力}<br>素早さ: ${opponent.素早さ}<br>賢さ: ${opponent.賢さ}<br>運の良さ: ${opponent.運の良さ}`;
}

document.getElementById('slimeStats').innerHTML = showStats('スライム');
document.getElementById('gorillaStats').innerHTML = showStats('ゴリラ');
document.getElementById('dragonStats').innerHTML = showStats('ドラゴン');

updateDisplay();


function getCurrentStatus() {
const playerName = document.getElementById('playerName').value || 'プレイヤー';

// ステータスにアイテム効果を反映
const modifiedParameters = parameters.map(param => {
const modifiedParam = { ...param };
acquiredItems.forEach(item => {
if (item.effect[modifiedParam.name]) {
modifiedParam.value += item.effect[modifiedParam.name];
}
});
return modifiedParam;
});

const status = `名前: ${playerName}, 攻撃力: ${modifiedParameters[0].value}, 防御力: ${modifiedParameters[1].value}, 体力: ${modifiedParameters[2].value}, 素早さ: ${modifiedParameters[3].value}, 賢さ: ${modifiedParameters[4].value}, 運の良さ: ${modifiedParameters[5].value}`;

// ここでステータスをopponentStatusに表示
document.getElementById('opponentStatus').value = status;
}

function parseStatus(status) {
const parts = status.split(', ').map(part => part.split(': ')[1]);
return {
name: parts[0],
攻撃力: parseInt(parts[1]),
防御力: parseInt(parts[2]),
体力: parseInt(parts[3]),
素早さ: parseInt(parts[4]),
賢さ: parseInt(parts[5]),
運の良さ: parseInt(parts[6])
};
}

function startPlayerBattle() {
const opponentStatus = document.getElementById('opponentStatus').value;
if (!opponentStatus) {
alert('他プレイヤーのステータスを入力してください。');
return;
}

const opponent = parseStatus(opponentStatus);
const player = {
name: document.getElementById('playerName').value || 'プレイヤー',
攻撃力: parameters[0].value,
防御力: parameters[1].value,
体力: parameters[2].value,
素早さ: parameters[3].value,
賢さ: parameters[4].value,
運の良さ: parameters[5].value
};

// アイテム補正を追加
acquiredItems.forEach(item => {
Object.entries(item.effect).forEach(([key, value]) => {
player[key] += value;
});
});

// 賢さの25％分の補正を追加
const intelligenceBonus = Math.floor(player.賢さ * 0.25);
const opponentIntelligenceBonus = Math.floor(opponent.賢さ * 0.25);
['攻撃力', '防御力', '体力', '素早さ', '運の良さ'].forEach(param => {
player[param] += intelligenceBonus;
opponent[param] += opponentIntelligenceBonus;
});

const battleLog = document.getElementById('battleLog');
battleLog.style.display = 'block';
battleLog.innerHTML = '';

function logBattle(message, className) {
battleLog.innerHTML += `<p class="${className}">${message}</p>`;
}

function calculateDamage(attacker, defender) {
let damage = Math.ceil((attacker.攻撃力 - (defender.防御力 - 10)) * 0.1);
damage = Math.max(damage, 1); // Ensure damage is at least 1
if (Math.random() * 100 < attacker.運の良さ / 2) {
damage += Math.ceil(1.2 * damage * (attacker.運の良さ / 100));
logBattle('クリティカルヒット！ダメージが増加しました。', attacker === player ? 'player-log' : 'opponent-log');
}
return damage;
}

function battleTurn(attacker, defender, attackerName, defenderName, className) {
const dodgeRate = calculateDodgeRate(defender);
if (Math.random() * 100 < dodgeRate) {
logBattle(`${attackerName}の攻撃は避けられた！`, className);
return false;
}
let damage = calculateDamage(attacker, defender);
defender.体力 -= damage;
logBattle(`${attackerName}の攻撃！${defenderName}に${damage}のダメージ。残り体力: ${defender.体力}`, className);
if (defender.体力 <= 0) {
logBattle(`${defenderName}は倒れた！`, className);
return true;
}
return false;
}

function battle() {
let playerTurn = player.素早さ >= opponent.素早さ;
while (player.体力 > 0 && opponent.体力 > 0) {
if (playerTurn) {
if (battleTurn(player, opponent, player.name, opponent.name, 'player-log')) {
logBattle('プレイヤーの勝利！', 'result-log');
break;
}
} else {
if (battleTurn(opponent, player, opponent.name, player.name, 'opponent-log')) {
logBattle('相手の勝利...', 'result-log');
break;
}
}
playerTurn = !playerTurn;
}
}

battle();
}

</script>

<br><br>
<div style="font-size: 0.9em;">
操作説明<br>
・ステータスポイントを使ってステータスをあげよう！上がるかどうかは運次第！<br>
・ステータスが高くなればなるほど、強化成功率は下がっていきます。<br>
・ステータス強化に失敗すると次は少し成功しやすくなります。<br> 
・レベルアップボタンを押すとレベルが上がり、1LVにつき10ポイント追加されます。<br>
・最大レベルは50です。レベルが低いほど対戦時のスコアにボーナスが入ります。<br>
・「〇〇と戦う」ボタンを押すとCPUと対戦します。ハイスコアを目指そう。<br><br>
<hr>
<br>

アイテム一覧<br>
包丁：攻撃力+5　/　
鋼の剣：攻撃力+10　/　
伝説の剣：攻撃力+15<br>
革ジャン：防御力+5　/　
防弾チョッキ：防御力+10　/　
ダイヤの鎧：防御力+15<br>
スニーカー：素早さ+5　/　
俊足：素早さ+10　/　
ジェットシューズ：素早さ+15<br>
ポーション：体力+10　/　
ハイポーション：体力+20 <br>
四葉のクローバー：運の良さ+10　/　
招き猫：運の良さ+15<br>
サーカスの服：攻撃回避率+10　/　
ただのゴミ：効果なし<br>

<hr>
<br>
ヒント<br>
強い敵ほどスコアの基準値が上がる。<br>
レベルが低いほどスコアが上がる。<br>
攻撃力が高いほどスコアが上がる。<br>
防御力が高いほどスコアが上がる。<br>
戦闘終了時の残り体力が高いほどスコアが上がる。<br>
素早さが高いほど回避率が上がる。<br>
相手より素早さが高いほど連続で攻撃する。<br>
連続で攻撃するほどスコアがあがる。<br>
賢さが高いほど他のステータスに補正がかかる。<br>
運の良さが高いほど回避率とクリティカル率・ダメージが上がる。<br>
クリティカルが発生するほどスコアが上がる。<br>
</div>
</body>
</html>


